# HTTP 쿠키

HTTP 쿠키는 웹 서버가 사용자의 웹 브라우저에 저장하는 작은 데이터 조각으로 주로 사용자 식별, 세션 관리, 사용자 설정 저장 등의 목적으로 사용된다.

- 쿠키는 클라이언트에 저장되는 key-value 형태의 데이터이다.
- 서버가 Set-Cookie 헤더를 통해 브라우저에 쿠키를 저장.
- 브라우저는 같은 서버에 요청할 때마다 Cookie 헤더에 쿠키를 포함시켜 보낸다.

## 쿠키의 사용 목적

- 세션 관리: 로그인 상태 유지, 사용자 인증 등
- 개인화: 사용자 선호 설정 저장
- 트래킹: 사용자 행동 추적

과거에는 클라이언트 측에 정보를 저장할 때 쿠키를 주로 사용하였지만 현재는 modern storage APIs를 사용해 정보를 저장하는 것을 권장한다. 모든 요청마다 쿠키가 함께 전송 되기 때문에 성능이 떨어지는 원인이 될 수 있다.

## 쿠기 만들기

HTTP 요청을 수신할 때, 서버는 응답과 함께 `Set-Cooki` 헤더를 전송할 수 있다. 쿠키는 보통 브라우저에 의해 저장되며, 이 후 쿠키는 같은 서버에 의해 만들어진 요청들의 HTTP 헤더안에 `Cookie`가 포함되어 전송된다. 만료일, 지속시간도 명시될 수 있고, 만료된 쿠키는 더이상 전송되지 않는다. 특정 도메인 혹은 경로 제한을 설정할 수도 있으며 이는 쿠키가 보내지는 것을 제한할 수 있다.

### 쿠키의 라이프타임

- 세션 쿠키: `Expires`, `Max-Age` 속성이 없는 쿠키는 현재 세션이 끝날 때 삭제된다. 브라우저는 "현재 세션"이 끝나는 시점의 정의하며, 어떤 브라우저들은 재시작할 때 세션을 복원해 세션 쿠키가 무기한 존재할 수 있도록 한다.
- 영속적인 쿠키: `Expires` 속성에 명시된 날짜에 삭제되거나, `Max-Age` 속성에 명시된 기간 이후에 삭제된다.

## `Secure`와 `HttpOnly` 쿠키

`Secure` 쿠키는 HTTPS 프로토콜 상에서 암호화된 요청일 경우에만 전송된다. 하지만 `Secure` 일지라도 민감한 정보는 절대 쿠키에 저장되면 안된다.

Cross-site 스크립팅(XSS) 공격을 방지하기 위해, `HttpOnly` 쿠키는 JavaScript의 `Document.cookie` API에 접근할 수 없다. 서버에서만 전송되기만 하며 서버 쪽에서 지속되고 있는 세션의 쿠키는 JavaScript를 사용할 필요성이 없기 때문에 `HttpOnly` 플래그를 사용한다.
